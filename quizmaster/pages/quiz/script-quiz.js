const base = [
    [
        {
            nameEn: 'Super Mario',
            en:
                'Super Mario is a platform game series created by Nintendo starring their mascot, Mario. At least one Super Mario game has been released for every major Nintendo video game console.',
        },
        {
            nameEn: 'Battle City',
            en:
                "Battle City is a multi-directional shooter video game for the Family Computer produced and published in 1985 by Namco. It is a successor to Namco's 1980 Tank Battalion.",
        },
        {
            nameEn: 'Contra Force',
            en:
                'Contra Force is an action shooting game released by Konami for the Nintendo Entertainment System in 1992 in North America. It is a spinoff of the Contra series.',
        },
        {
            nameEn: "Chip'n Dale",
            en:
                'Originally released for the Nintendo Entertainment System in Japan and North America in 1990, it came to Europe the next year, and was ported to the Nintendo PlayChoice-10 arcade system.',
        },
        {
            nameEn: 'Adventure Island II',
            en:
                'It is a side-scrolling platform game developed by Now Production and published by Hudson Soft that was released for the Nintendo Entertainment System in 1991.',
        },
        {
            nameEn: 'Jackal',
            en:
                'Jackal, also distributed under the title of Top Gunner, is an overhead run-and-gun shooter by Konami released as an arcade video game in 1986.',
        },
        {
            questionEn:
                'Hi all! Do you remember the music from the 8 bit console?',
        },
    ],
    [
        {
            nameEn: 'Kings Bounty',
            en:
                'It is an adventure game with tactical turn-based battles and role-playing elements. In a fairy tale fantasy world of fearless knights, evil mages, wise kings and beautiful princesses the player controls a hero.',
        },
        {
            nameEn: 'HOMM IV',
            en:
                'It is a turn-based strategy game developed by Gus Smedstad through New World Computing and published by the 3DO Company for Microsoft Windows-based personal computers in 2002.',
        },
        {
            nameEn: 'Starcraft',
            en:
                'StarCraft is a military science fiction media franchise created by Chris Metzen and James Phinney and owned by Blizzard Entertainment.',
        },
        {
            nameEn: 'Diablo II',
            en:
                'Diablo II is an action role-playing hack-and-slash video game developed by Blizzard North and published by Blizzard Entertainment in 2000 for Microsoft Windows, Classic Mac OS, and macOS.',
        },
        {
            nameEn: 'Age of Mythology',
            en:
                'Age of Mythology is a real-time strategy video game developed by Ensemble Studios and published by Microsoft Game Studios. It was released on October 30, 2002.',
        },
        {
            nameEn: 'Slay the Spire',
            en:
                'It is a roguelike deck-building video game developed by American studio MegaCrit and published by Humble Bundle. The game was first released in early access in late 2017, with an official release in January 2019.',
        },
        {
            questionEn:
                "Now let's move on to a new theme: RPG/strategy. Listen!",
        },
    ],
    [
        {
            nameEn: 'World of Tanks',
            en:
                'World of Tanks is a massively multiplayer online game developed by Belarusian company Wargaming, featuring 20th century era combat vehicles.',
        },
        {
            nameEn: 'World of Warcraft',
            en:
                'World of Warcraft is a massively multiplayer online role-playing game released in 2004 by Blizzard Entertainment.',
        },
        {
            nameEn: 'Lineage II',
            en:
                'Lineage II is a massively multiplayer online role-playing game for Microsoft Windows and the second game in the Lineage series. ',
        },
        {
            nameEn: 'Archeage',
            en:
                'ArcheAge is an MMORPG developed by Korean developer Jake Song and his development company, XL Games. The game was released in Korea on January 15, 2013',
        },
        {
            nameEn: 'Hearthstone',
            en:
                'Hearthstone is a free-to-play online digital collectible card game developed and published by Blizzard Entertainment.',
        },
        {
            nameEn: 'Royal Quest',
            en:
                'Royal Quest is an MMORPG developed by Katauri Interactive and set in a fantasy world named Aura, full of magic, technology and alchemy.',
        },
        {
            questionEn:
                "Who hasn't played online games yet? \u00A0\u00A0\u00A0\u00A0 It will be very easy.",
        },
    ],
    [
        {
            nameEn: 'Serious Sam 2',
            en:
                'Serious Sam 2 is a first-person shooter video game and the sequel to the 2001 video game Serious Sam. It was developed by Croteam and was released on 11 October 2005.',
        },
        {
            nameEn: 'Quake 3 Arena',
            en:
                'Quake III Arena is a 1999 multiplayer-focused first-person shooter developed by id Software. The third installment of the Quake series.',
        },
        {
            nameEn: 'Far Cry 4',
            en:
                'Far Cry 4 is a 2014 first-person shooter game developed by Ubisoft Montreal and published by Ubisoft. It is the fourth main installment in the Far Cry series.',
        },
        {
            nameEn: 'Unreal Tournament',
            en:
                'Unreal Tournament is a first-person arena shooter video game developed by Epic Games and Digital Extremes. ',
        },
        {
            nameEn: "Assassin's Creed II",
            en:
                "Assassin's Creed II is a 2009 action-adventure video game developed by Ubisoft Montréal and published by Ubisoft. It is the second major installment in the Assassin's Creed series.",
        },
        {
            nameEn: 'Doom',
            en:
                "Doom is a 2016 first-person shooter game developed by id Software and published by Bethesda Softworks. It is the first major installment in the Doom series since 2004's Doom 3.",
        },
        {
            questionEn:
                'There is also such a category of games as action / shooter.',
        },
    ],
    [
        {
            nameEn: 'Zanzarah',
            en:
                'It is an amazingly enjoyable adventure game brought to life by a vividly visualized and elaborately produced world.',
        },
        {
            nameEn: 'Minecraft',
            en:
                'Minecraft is an open-ended, exploration- and creation-focused environment. Players can create items and buildings from scratch using materials they harvest from the world around them.',
        },
        {
            nameEn: 'Portal',
            en:
                'Portal is a 2007 puzzle-platform game developed and published by Valve. It was released in a bundle, The Orange Box, for Windows, Xbox 360 and PlayStation 3, and has been since ported to other systems.',
        },
        {
            nameEn: 'House-Flipper',
            en:
                'House Flipper is a simulation game that was developed by Frozen District and published by PlayWay S.A.. It was released on May 17, 2018.',
        },
        {
            nameEn: 'NFS Most Wanted',
            en:
                "The open-world action in Need for Speed Most Wanted gives you the freedom to drive your way. Hit jumps and shortcuts, switch cars, lie low, or head for terrain that plays to your vehicle's unique strengths. ",
        },
        {
            nameEn: 'Mech Commander 2',
            en:
                'MechCommander 2 is a 2001 real-time tactics video game based on the BattleTech/MechWarrior franchise, developed by FASA Interactive and distributed by Microsoft. ',
        },
        {
            questionEn:
                'Last chance to get a lot of points. \u00A0 Theme: adventure / simulation',
        },
    ],
    [
        {
            nameEn: 'Battle Cats',
            en:
                'The Battle Cats is a free-to-play tower defense game developed and published by PONOS Corporation. Software has been released on iOS, Android, and Microsoft Windows.',
        },
        {
            nameEn: 'Clash Royale',
            en:
                'Clash Royale is a free-to-play real-time strategy video game developed and published by Supercell. The game combines elements from collectible card games, tower defense, and multiplayer online battle arena.',
        },
        {
            nameEn: 'Township',
            en:
                'Township is a casual farming and city-building game developed and launched on multiple platforms by Playrix in which players develop starter towns by building factories, harvesting crops, and creating goods. ',
        },
        {
            nameEn: 'Subway Surfers',
            en:
                'Subway Surfers is an endless runner mobile game co-developed by Kiloo and SYBO Games, private companies based in Denmark.',
        },
        {
            nameEn: 'Plants vs Zombies',
            en:
                'Plants vs. Zombies is a 2009 tower defense video game developed and published by PopCap Games.The game has been ported to consoles, handhelds, and mobile devices.',
        },
        {
            nameEn: 'Talking Tom Gold Run',
            en:
                'Talking Tom Gold Run is an entertaining online runner game. Have hours of fun with your beloved cat, run as quickly as you can, and gather as many gold coins as you can. ',
        },
        {
            questionEn:
                'What about mobile games? You may have some of them on your phone.',
        },
    ],
]

let stage = 1 //текущий этап
let score = 0 //текущий счёт
let prize = 5 //текущие баллы за правильный ответ
let orderCurrent //хранит номер правильного ответа от 0 до 5
let audioCurrent = new Audio() //хранит текущее аудио
audioCurrent.volume = 0.6
let audioTrue = new Audio('../../assets/audio/true.mp3')
let audioFalse = new Audio('../../assets/audio/false.mp3')
let audioClick = new Audio('../../assets/audio/click.mp3')
let progressbarCurrent
let valueCurrent

const mainStageCurrent = document.querySelector('.main-stage-current')
const mainScoreCurrent = document.querySelector('.main-score-current')
const mainQuestionTxt = document.querySelector('.main-question-txt')
const soundPlay = document.querySelector('.sound-play')
const soundProgressbar = document.querySelector('.sound-progressbar')
const audioMute = document.querySelector('.audio-play')
const audioVolume = document.querySelector('.audio-volume')
const audioTime = document.querySelector('.audio-time')
const answerName = document.querySelector('.answer-name')
const answerImg = document.querySelector('.answer-img')
const answerPlayWrapper = document.querySelector('.answer-play-wrapper')
const answerPlay = document.querySelector('.answer-play')
const answerProgressbar = document.querySelector('.answer-progressbar')
const answerDescription = document.querySelector('.answer-description')
const choice = document.querySelectorAll('.choice')
const mainNext = document.querySelector('.main-next')

function loadMainContent() {
    orderCurrent = Math.trunc(Math.random() * 6)
    getAudio(orderCurrent)
    mainQuestionTxt.textContent = base[stage - 1][6].questionEn
    for (let i = 0; i < choice.length; i++) {
        choice[i].firstChild.data = base[stage - 1][i].nameEn
        choice[i].classList.remove('choice-true')
        choice[i].classList.remove('choice-false')
    }
    answerDescription.classList.remove('answer-description-active')
    answerPlayWrapper.classList.remove('answer-play-wrapper-active')
    answerName.textContent = '***'
    answerImg.style.backgroundImage =
        'url(../../assets/image/background/background-2.png)'
    mainNext.classList.remove('main-next-active')
    mainStageCurrent.textContent = stage.toString()
}

loadMainContent()

for (let i = 0; i < choice.length; i++) {
    choice[i].addEventListener('click', function () {
        if (choice[orderCurrent].classList.contains('choice-true')) {
            //правильный ответ УЖЕ найден
            audioClick.currentTime = 0
            audioClick.play()
            loadAnswerContent(i)
            audioStop()
            setTimeout(audioTimeupdateReset, 50)
            setTimeout(getAudio, 100, i)
        } else {
            //правильный ответ ЕЩЁ НЕ найден
            if (i === orderCurrent) {
                //это правильный ответ
                audioTrue.currentTime = 0
                audioTrue.play()
                audioStop()
                setTimeout(audioTimeupdateReset, 50)
                if (!choice[i].classList.contains('choice-true')) {
                    score += prize
                    mainScoreCurrent.textContent = score.toString()
                }
                choice[i].classList.add('choice-true')
                mainNext.classList.add('main-next-active')
                loadAnswerContent(i)
                answerDescription.classList.add('answer-description-active')
                answerPlayWrapper.classList.add('answer-play-wrapper-active')
            } else {
                //это не правильный ответ
                audioFalse.currentTime = 0
                audioFalse.play()
                if (!choice[i].classList.contains('choice-false')) {
                    prize--
                }
                choice[i].classList.add('choice-false')
            }
        }
    })
}

function loadAnswerContent(n) {
    answerName.textContent = base[stage - 1][n].nameEn
    answerImg.style.backgroundImage = `url(../../assets/image/collection/${
        stage - 1
    }/${n}.jpg)`
    answerDescription.textContent = base[stage - 1][n].en
}

mainNext.addEventListener('click', function () {
    if (stage < 6) {
        if (mainNext.classList.contains('main-next-active')) {
            prize = 5
            audioStop()
            audioTimeupdateReset()
            audioClick.currentTime = 0
            audioClick.play()
            stage++
            loadMainContent()
        }
    } else {
        prize = 5
        audioStop()
        audioTimeupdateReset()
        audioClick.currentTime = 0
        audioClick.play()
        localStorage.setItem('score', score)
        window.location.href = '../result/result.html'
    }
})

function getAudio(n) {
    let temp = audioCurrent.volume
    audioCurrent.removeEventListener('timeupdate', audioTimeupdate)
    audioCurrent.removeEventListener('ended', audioEnded)
    audioCurrent = new Audio(`../../assets/audio/${stage - 1}/${n}.mp3`)
    audioCurrent.addEventListener('timeupdate', audioTimeupdate)
    audioCurrent.addEventListener('ended', audioEnded)
    audioCurrent.volume = temp
}

soundPlay.addEventListener('click', function () {
    if (!soundPlay.classList.contains('sound-play-paused')) {
        audioPlay()
    } else {
        audioStop()
    }
})

answerPlay.addEventListener('click', function () {
    if (!answerPlay.classList.contains('answer-play-paused')) {
        audioPlay()
    } else {
        audioStop()
    }
})

function audioStop() {
    soundPlay.classList.remove('sound-play-paused')
    answerPlay.classList.remove('answer-play-paused')
    audioCurrent.pause()
}

function audioPlay() {
    soundPlay.classList.add('sound-play-paused')
    answerPlay.classList.add('answer-play-paused')
    audioCurrent.play()
}

soundProgressbar.addEventListener('input', function () {
    progressbarCurrent = this.value
    audioCurrent.currentTime =
        (audioCurrent.duration / 1000) * progressbarCurrent
    soundProgressbar.style.background = `linear-gradient(
        to right, 
        #dfe6fd ${progressbarCurrent / 10}%, 
        #dfe6fd ${progressbarCurrent / 10}%, 
        #4d498d 0%, 
        #4d498d 100%)`
    answerProgressbar.style.background = `linear-gradient(
        to right, 
        #dfe6fd ${progressbarCurrent / 10}%, 
        #dfe6fd ${progressbarCurrent / 10}%, 
        #4d498d 0%, 
        #4d498d 100%)`
    soundProgressbar.blur()
})

answerProgressbar.addEventListener('input', function () {
    progressbarCurrent = this.value
    audioCurrent.currentTime =
        (audioCurrent.duration / 1000) * progressbarCurrent
    soundProgressbar.style.background = `linear-gradient(
        to right, 
        #dfe6fd ${progressbarCurrent / 10}%, 
        #dfe6fd ${progressbarCurrent / 10}%, 
        #4d498d 0%, 
        #4d498d 100%)`
    answerProgressbar.style.background = `linear-gradient(
        to right, 
        #dfe6fd ${progressbarCurrent / 10}%, 
        #dfe6fd ${progressbarCurrent / 10}%, 
        #4d498d 0%, 
        #4d498d 100%)`
    answerProgressbar.blur()
})

//audioCurrent.addEventListener('timeupdate', audioTimeupdate)

function audioTimeupdate() {
    soundProgressbar.value =
        (audioCurrent.currentTime * 1000) / audioCurrent.duration
    soundProgressbar.style.background = `linear-gradient(
    to right,
    #dfe6fd ${soundProgressbar.value / 10}%,
    #dfe6fd ${soundProgressbar.value / 10}%, 
    #4d498d 0%, 
    #4d498d 100%)`
    answerProgressbar.value =
        (audioCurrent.currentTime * 1000) / audioCurrent.duration
    answerProgressbar.style.background = `linear-gradient(
    to right,
    #dfe6fd ${answerProgressbar.value / 10}%,
    #dfe6fd ${answerProgressbar.value / 10}%, 
    #4d498d 0%, 
    #4d498d 100%)`
    audioTime.textContent = audioTimeCurrent(
        audioCurrent.currentTime,
        audioCurrent.duration
    )
    soundProgressbar.blur()
    answerProgressbar.blur()
}

function audioTimeupdateReset() {
    audioCurrent.currentTime = 0
    soundProgressbar.value = 0
    soundProgressbar.style.background = `linear-gradient(
        to right,
        #dfe6fd 0%,
        #dfe6fd 0%, 
        #4d498d 0%, 
        #4d498d 100%)`
    answerProgressbar.value = 0
    answerProgressbar.style.background = `linear-gradient(
        to right,
        #dfe6fd 0%,
        #dfe6fd 0%, 
        #4d498d 0%, 
        #4d498d 100%)`
    audioTime.textContent = '0:00 / 0:00'
}

function audioTimeCurrent(curr, total) {
    curr = Math.floor(curr)
    total = Math.floor(total)
    let currMin = ((curr - (curr % 60)) / 60).toString()
    let currSec
    curr % 60 < 10
        ? (currSec = '0' + (curr % 60).toString())
        : (currSec = (curr % 60).toString())
    let totalMin = ((total - (total % 60)) / 60).toString()
    let totalSec
    total % 60 < 10
        ? (totalSec = '0' + (total % 60).toString())
        : (totalSec = (total % 60).toString())
    if (isNaN(totalMin)) {
        totalMin = '0'
        totalSec = '00'
    }
    return `${currMin}:${currSec} / ${totalMin}:${totalSec}`
}

//audioCurrent.addEventListener('ended', audioEnded)

function audioEnded() {
    soundPlay.classList.remove('sound-play-paused')
    answerPlay.classList.remove('answer-play-paused')
    audioTimeupdateReset()
}

audioVolume.addEventListener('input', function () {
    valueCurrent = this.value
    audioCurrent.volume = valueCurrent / 100
    audioVolume.style.background = `linear-gradient(
        to right, 
        #dfe6fd ${valueCurrent}%, 
        #dfe6fd ${valueCurrent}%, 
        #4d498d 0%, 
        #4d498d 100%)`
    if (
        audioMute.classList.contains('audio-play-muted') &&
        valueCurrent !== '0'
    ) {
        audioMute.classList.remove('audio-play-muted')
    }
    if (valueCurrent === '0') {
        audioMute.classList.add('audio-play-muted')
    }
    audioVolume.blur()
})

let volumeCurrentMemory = 0
let volumeValueCurrentMemory = 0

audioMute.addEventListener('click', function () {
    if (!audioMute.classList.contains('audio-play-muted')) {
        audioMute.classList.add('audio-play-muted')
        volumeCurrentMemory = audioCurrent.volume
        audioCurrent.volume = 0
        volumeValueCurrentMemory = audioVolume.value
        audioVolume.value = 0
        audioVolume.style.background = `linear-gradient(
            to right, 
            #dfe6fd 0%, 
            #dfe6fd 0%, 
            #4d498d 0%, 
            #4d498d 100%)`
    } else {
        audioMute.classList.remove('audio-play-muted')
        audioCurrent.volume = volumeCurrentMemory
        audioVolume.value = volumeValueCurrentMemory
        audioVolume.style.background = `linear-gradient(
            to right, 
            #dfe6fd ${volumeCurrentMemory * 100}%, 
            #dfe6fd ${volumeCurrentMemory * 100}%, 
            #4d498d 0%, 
            #4d498d 100%)`
        volumeCurrentMemory = 0
        volumeValueCurrentMemory = 0
    }
    audioVolume.blur()
})
